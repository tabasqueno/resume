<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* CSS Reset for Kajabi integration */
    .resume-match-wrapper * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    
    /* Main container - fully responsive */
    .resume-match-wrapper {
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
      font-size: 16px;
      line-height: 1.5;
      color: #333;
    }
    
    .resume-upload-component {
      width: 100%;
      position: relative;
      margin: 0 auto;
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 0.25rem 0.375rem rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      overflow: hidden;
    }
    
    .component-title {
      font-size: 1.5rem;
      font-weight: bold;
      margin-top: 0;
      margin-bottom: 1rem;
      color: #333;
      text-align: center;
    }
    
    .form-container {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      width: 100%;
    }
    
    .text-areas-container {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      width: 100%;
    }
    
    .text-area-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      padding: 1rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      background-color: #fafafa;
      width: 100%;
    }
    
    .text-area-section h3 {
      margin-top: 0;
      margin-bottom: 0.625rem;
      color: #333;
      font-size: 1.125rem;
      font-weight: 600;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #d2356e;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      width: 100%;
      position: relative;
    }
    
    .form-group label {
      font-size: 0.875rem;
      font-weight: 500;
      color: #4B5563;
    }
    
    .text-input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #D1D5DB;
      border-radius: 0.375rem;
      font-family: inherit;
      font-size: 0.875rem;
      height: 50vh;
      max-height: 300px;
      min-height: 150px;
      resize: none;
      overflow-y: auto;
      
      /* Firefox scrollbar styling */
      scrollbar-width: thin;
      scrollbar-color: #d2356e transparent;
    }
    
    /* WebKit scrollbar styling */
    .text-input::-webkit-scrollbar {
      width: 0.5rem;
      height: 0.5rem;
    }
    
    .text-input::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .text-input::-webkit-scrollbar-thumb {
      background: #d2356e;
      border-radius: 1.25rem;
    }
    
    .text-input::-webkit-scrollbar-thumb:hover {
      background: #bb2d60;
    }
    
    /* Remove scrollbar arrows */
    .text-input::-webkit-scrollbar-button {
      display: none;
      height: 0;
      width: 0;
    }
    
    .text-input:focus {
      outline: none;
      border-color: #d2356e;
      box-shadow: 0 0 0 3px rgba(210, 53, 110, 0.25);
    }
    
    /* PDF upload section inside the text area */
    .pdf-upload-section {
      position: absolute;
      bottom: 0.625rem; 
      left: 0.625rem;
      right: 0.625rem;
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 0.375rem;
      border: 1px solid #e5e7eb;
      padding: 0.3125rem;
      z-index: 10;
    }
    
    .file-upload-area {
      width: 100%;
      border: 2px dashed #D1D5DB;
      border-radius: 0.375rem;
      padding: 0.3125rem;
      text-align: center;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .file-upload-area:hover {
      background-color: #F9FAFB;
    }
    
    .file-upload-content {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
    }
    
    #file-name {
      margin: 0;
      font-size: 0.75rem;
      color: #6B7280;
    }
    
    #file-input {
      display: none;
    }
    
    .error-message {
      color: #DC2626;
      font-size: 0.875rem;
      margin: 0.25rem 0 0 0;
      display: none;
    }
    
    .button-row {
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }
    
    /* Pushable Button Styles */
    .pushable {
      font-family: 'Source Sans 3', sans-serif;
      position: relative;
      background: transparent;
      padding: 0;
      border: none;
      cursor: pointer;
      outline-offset: 4px;
      outline-color: deeppink;
      transition: filter 250ms;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }
    .pushable .shadow {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background: hsl(226, 25%, 69%);
      border-radius: 12px;
      filter: blur(2px);
      will-change: transform;
      transform: translateY(2px);
      transition: transform 600ms cubic-bezier(0.3, 0.7, 0.4, 1);
    }
    .pushable .edge {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      border-radius: 12px;
      background: linear-gradient(
        to right,
        #bb1f58 0%,
        #cf487a 8%,
        #bb1f58 92%,
        #bb1f58 100%
      );
    }
    .pushable .front {
      font-family: 'Source Sans 3', sans-serif;
      /* Use flexbox to center text */
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      border-radius: 12px;
      background: #d2356e;
      /* Reduced vertical padding for less space above and below text */
      padding: 4px 32px;
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      font-size: 1.3rem;
      transform: translateY(-4px);
      transition: transform 600ms cubic-bezier(0.3, 0.7, 0.4, 1),
                  background 250ms cubic-bezier(0.3, 0.7, 0.4, 1.5);
    }
    /* Counter-transform the text to center it within the shifted container */
    .pushable .front .front-text {
      font-family: 'Source Sans 3', sans-serif;
      transform: translateY(2px);
    }
    .pushable:hover {
      /* Instead of brightness, we now change background via the front element */
      /* Remove filter brightness */
    }
    .pushable:hover .front {
      background: rgb(255, 53, 125);
      transform: translateY(-6px);
      transition: transform 250ms cubic-bezier(0.3, 0.7, 0.4, 1.5),
                  background 250ms cubic-bezier(0.3, 0.7, 0.4, 1.5);
    }
    .pushable:active .front {
      transform: translateY(-2px);
      transition: transform 34ms;
    }
    .pushable:hover .shadow {
      transform: translateY(4px);
      transition: transform 250ms cubic-bezier(0.3, 0.7, 0.4, 1.5);
    }
    .pushable:active .shadow {
      transform: translateY(1px);
      transition: transform 34ms;
    }
    .pushable:focus:not(:focus-visible) {
      outline: none;
    }
    
    /* Disabled state for pushable button */
    .pushable.disabled {
      cursor: not-allowed;
    }
    .pushable.disabled .shadow {
      background: #c5c8d0;
    }
    .pushable.disabled .edge {
      background: #9CA3AF;
    }
    .pushable.disabled .front {
      background: #9CA3AF;
      color: #e2e2e2;
    }
    
    .success-message {
      background-color: #D1FAE5;
      color: #065F46;
      padding: 0.75rem;
      border-radius: 0.375rem;
      text-align: center;
    }
    
    .hidden {
      display: none;
    }
    
    .component-header {
      display: flex;
      justify-content: center;
      position: relative;
      margin-bottom: 1.5rem;
    }
    
    /* Responsive styling for Kajabi breakpoints */
    @media (min-width: 640px) {
      .resume-upload-component {
        padding: 1.5rem;
      }
    }
    
    @media (min-width: 768px) {
      .text-areas-container {
        flex-direction: row;
      }
      
      .text-area-section {
        width: 50%;
      }
      
      .component-title {
        font-size: 1.75rem;
      }
    }
    
    @media (min-width: 1024px) {
      .resume-upload-component {
        padding: 2rem;
      }
      
      .component-title {
        font-size: 2rem;
      }
    }
    
    /* Handle Kajabi parents with specific max-widths */
    @media (max-width: 400px) {
      .text-input {
        height: 40vh;
      }
      
      .pushable {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="resume-match-wrapper">
    <div class="resume-upload-component">
      <div class="component-header">
        <h2 class="component-title">Resume Match</h2>
      </div>
      
      <div class="form-container">
        <div class="text-areas-container">
          <div class="text-area-section">
            <h3>Resume</h3>
            <div class="form-group">
              <textarea id="resume-text" class="text-input" placeholder="Type your resume content here..."></textarea>
              
              <div class="pdf-upload-section">
                <div class="file-upload-area" id="drop-area">
                  <div class="file-upload-content">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7 16C4.79086 16 3 14.2091 3 12C3 9.79086 4.79086 8 7 8C7.03834 8 7.07655 8.00032 7.11463 8.00097C7.58161 6.16273 9.14539 4.75516 11.0755 4.36548C13.0056 3.97581 15.0621 4.68544 16.2834 6.23602C17.5046 7.78659 17.7223 9.88582 16.8281 11.6288C16.8434 11.7195 16.8519 11.8113 16.8535 11.9032C16.8686 12.4505 16.7373 12.9913 16.4741 13.4654C16.211 13.9396 15.8246 14.3301 15.3548 14.5988C14.8851 14.8674 14.3485 15.0054 13.8014 14.9985C13.2542 14.9917 12.7214 14.8403 12.2588 14.5601M15 13L12 10M12 10L9 13M12 10V20" stroke="#d2356e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <p id="file-name">Click to upload PDF</p>
                  </div>
                  <input type="file" id="file-input" accept="application/pdf" />
                </div>
                <p id="file-error" class="error-message"></p>
              </div>
            </div>
          </div>
          
          <div class="text-area-section">
            <h3>Job Description</h3>
            <textarea id="job-description" class="text-input" placeholder="Paste the job description here..."></textarea>
          </div>
        </div>
        
        <div class="button-row">
          <button id="scan-button" class="pushable disabled" disabled>
            <span class="shadow"></span>
            <span class="edge"></span>
            <span class="front">
              <span class="front-text">Scan</span>
            </span>
          </button>
        </div>
        
      <div id="success-message" class="success-message hidden">
        Analysis complete!
      </div>
      
      <!-- Results section -->
      <div id="results-container" class="hidden" style="margin-top: 1.5rem;">
        <div class="text-area-section">
          <h3>Skills Analysis</h3>
          <div id="skills-list" class="skills-list">
            <!-- Skills will be populated here -->
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>

  <script>
    // Function to convert file to base64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => {
          // Remove the data URL prefix (e.g., "data:application/pdf;base64,")
          const base64String = reader.result.split(',')[1];
          resolve(base64String);
        };
        reader.onerror = error => reject(error);
      });
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      // Ensure our component fills its parent in Kajabi
      function adjustToParent() {
        const wrapper = document.querySelector('.resume-match-wrapper');
        if (wrapper && wrapper.parentElement) {
          wrapper.style.width = '100%';
          
          // Adjust text area heights based on available space
          const textInputs = document.querySelectorAll('.text-input');
          const viewportHeight = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
          const maxHeight = Math.min(300, viewportHeight * 0.5);
          
          textInputs.forEach(input => {
            input.style.maxHeight = maxHeight + 'px';
          });
        }
      }
      
      // Run initially and on resize
      adjustToParent();
      window.addEventListener('resize', adjustToParent);
      
      const resumeText = document.getElementById('resume-text');
      const jobDescription = document.getElementById('job-description');
      const fileInput = document.getElementById('file-input');
      const fileName = document.getElementById('file-name');
      const fileError = document.getElementById('file-error');
      const scanButton = document.getElementById('scan-button');
      const successMessage = document.getElementById('success-message');
      const dropArea = document.getElementById('drop-area');
      
      let file = null;
      
      // Text input events
      resumeText.addEventListener('input', validateForm);
      jobDescription.addEventListener('input', validateForm);
      
      // File input events
      fileInput.addEventListener('change', handleFileSelect);
      
      dropArea.addEventListener('click', function() {
        fileInput.click();
      });
      
      dropArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        dropArea.style.borderColor = '#ff69b4';
      });
      
      dropArea.addEventListener('dragleave', function() {
        dropArea.style.borderColor = '#D1D5DB';
      });
      
      dropArea.addEventListener('drop', function(e) {
        e.preventDefault();
        dropArea.style.borderColor = '#D1D5DB';
        
        if (e.dataTransfer.files.length) {
          handleFiles(e.dataTransfer.files);
        }
      });
      
      // Button events
      scanButton.addEventListener('click', handleScan);
      
      function handleFileSelect(e) {
        handleFiles(e.target.files);
      }
      
      function handleFiles(files) {
        const selectedFile = files[0];
        
        if (selectedFile) {
          if (selectedFile.type !== 'application/pdf') {
            showFileError('Please upload a PDF file');
            file = null;
            fileName.textContent = 'Click to upload PDF';
            fileInput.value = '';
          } else {
            file = selectedFile;
            fileName.textContent = selectedFile.name.length > 20 ? 
                                selectedFile.name.substring(0, 17) + '...' : 
                                selectedFile.name;
            hideFileError();
          }
        }
        
        validateForm();
      }
      
      function showFileError(message) {
        fileError.textContent = message;
        fileError.style.display = 'block';
      }
      
      function hideFileError() {
        fileError.textContent = '';
        fileError.style.display = 'none';
      }
      
      function validateForm() {
        const hasResumeContent = resumeText.value.trim() !== '' || file !== null;
        const hasJobContent = jobDescription.value.trim() !== '';
        
        if (hasResumeContent && hasJobContent) {
          scanButton.disabled = false;
          scanButton.classList.remove('disabled');
        } else {
          scanButton.disabled = true;
          scanButton.classList.add('disabled');
        }
      }
      
      function handleScan(e) {
        e.preventDefault();
        
        if ((!resumeText.value.trim() && !file) || !jobDescription.value.trim()) {
          return;
        }
        
        // Update button state
        scanButton.querySelector('.front-text').textContent = 'Scanning...';
        scanButton.disabled = true;
        scanButton.classList.add('disabled');
        
        // Hide previous results if any
        document.getElementById('results-container').classList.add('hidden');
        
        // Prepare the request data
        const requestData = {
          jobDescription: jobDescription.value.trim()
        };
        
        // Process based on input type (text or PDF)
        const processRequest = async () => {
          try {
            if (file) {
              // Convert PDF to base64
              const base64Data = await fileToBase64(file);
              requestData.resumePdfBase64 = base64Data;
            } else {
              requestData.resumeText = resumeText.value.trim();
            }
            
            // Send to API
            const response = await fetch('https://resume-eta-lime.vercel.app/api/analyze', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(requestData)
            });
            
            if (!response.ok) {
              throw new Error(`API error: ${response.status}`);
            }
            
            const result = await response.json();
            displayResults(result);
            
            // Show success message
            successMessage.classList.remove('hidden');
            
            // Hide success message after 3 seconds
            setTimeout(function() {
              successMessage.classList.add('hidden');
            }, 3000);
          } catch (error) {
            console.error('Error during analysis:', error);
            // More detailed error message
            let errorMessage = 'An error occurred during analysis: ';
            
            if (error.message) {
              errorMessage += error.message;
            } else if (error.toString) {
              errorMessage += error.toString();
            }
            
            // Check for specific error types
            if (error instanceof TypeError && error.message.includes('NetworkError')) {
              errorMessage = 'Network error: Unable to connect to the analysis server. This might be due to CORS restrictions or the server being unavailable.';
            }
            
            alert(errorMessage);
          } finally {
            // Reset button state
            scanButton.querySelector('.front-text').textContent = 'Scan';
            scanButton.disabled = false;
            scanButton.classList.remove('disabled');
          }
        };
        
        processRequest();
      }
      
      // Function to display results
      function displayResults(data) {
        const resultsContainer = document.getElementById('results-container');
        const skillsList = document.getElementById('skills-list');
        
        // Clear previous results
        skillsList.innerHTML = '';
        
        // Create skill items
        if (data.skills && data.skills.length > 0) {
          data.skills.forEach(skill => {
            const skillItem = document.createElement('div');
            skillItem.className = 'skill-item';
            skillItem.style.padding = '1rem';
            skillItem.style.marginBottom = '0.75rem';
            skillItem.style.borderRadius = '0.5rem';
            skillItem.style.border = '1px solid #e5e7eb';
            
            // Set background color based on presence
            if (skill.present) {
              skillItem.style.backgroundColor = '#D1FAE5';
              skillItem.style.borderLeft = '4px solid #10B981';
            } else {
              skillItem.style.backgroundColor = '#FEE2E2';
              skillItem.style.borderLeft = '4px solid #EF4444';
            }
            
            // Create skill content
            const skillContent = `
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <h4 style="font-weight: 600; margin: 0; color: #333;">${skill.skill}</h4>
                <span style="font-weight: 600; color: ${skill.present ? '#10B981' : '#EF4444'};">
                  ${skill.present ? 'PRESENT' : 'MISSING'}
                </span>
              </div>
              <p style="margin: 0; font-size: 0.875rem; color: #4B5563;">${skill.explanation}</p>
            `;
            
            skillItem.innerHTML = skillContent;
            skillsList.appendChild(skillItem);
          });
          
          // Show results container
          resultsContainer.classList.remove('hidden');
        }
      }
    });
  </script>
</body>
</html>
